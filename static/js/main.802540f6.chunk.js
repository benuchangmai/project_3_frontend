(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{11:function(e,t,s){e.exports=s(17)},16:function(e,t,s){},17:function(e,t,s){"use strict";s.r(t);var a=s(0),n=s.n(a),r=s(10),o=s.n(r),i=(s(16),s(2)),c=s(3),l=s(5),u=s(4),m=s(1),h=s(6),g=(s(7),function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={username:"",password:"",url:s.props.url},s.onChangeUsername=s.onChangeUsername.bind(Object(m.a)(s)),s.onChangePwd=s.onChangePwd.bind(Object(m.a)(s)),s.onSubmit=s.onSubmit.bind(Object(m.a)(s)),s.onChangeUrl=s.onChangeUrl.bind(Object(m.a)(s)),s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeUrl",value:function(e){this.setState({url:e.target.value})}},{key:"onChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"onChangePwd",value:function(e){this.setState({password:e.target.value})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSubmit(this.state.username,this.state.password,this.state.url)}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("form",{className:"login-form",onSubmit:this.onSubmit},n.a.createElement("input",{type:"text",value:this.state.url,placeholder:"Chat URL",onChange:this.onChangeUrl}),n.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,onChange:this.onChangeUsername}),n.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,onChange:this.onChangePwd}),n.a.createElement("input",{type:"submit",className:"Loginbutton",value:"Login"})))}}]),t}(n.a.Component)),p=s(8),d=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"popup"},n.a.createElement("div",{className:"popup_inner"},n.a.createElement("button",{className:"popup_click",onClick:this.props.closePopup},"New message(s)")))}}]),t}(n.a.Component),S=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e))).togglePopup=function(){s.scrollToBottom(),s.atBottom=!0,s.setState({showPopup:!1})},s.scrollToBottom=function(){s.messagesEnd.scrollIntoView({behavior:"smooth"}),s.props.changeScrollState(!0),console.log("At bottom: ",!0)},s.handleScroll=function(e){var t=e.target;console.log(t.scrollHeight,t.scrollTop,t.clientHeight),t.scrollHeight-t.scrollTop-1<t.clientHeight?(s.props.changeScrollState(!0),s.atBottom=!0,console.log("At bottom from handleScroll: ",!0),s.setState({showPopup:!1})):(s.props.changeScrollState(!1),s.atBottom=!1,console.log("At bottom from handleScroll: ",!1))},s.renderMessage=function(e){var t=e.user,a=e.message,r=new Date(1e3*e.created),o=r.getHours()+":"+("0"+r.getMinutes()).substr(-2),i="Server"===t,c=i?"Server":"Message",l=i?"":t,u=l===sessionStorage.getItem("currentUsername"),m=u?"Messages-message-currentMember":"Messages-message";return s.messageFromSelf=!!u,n.a.createElement("li",{className:c},n.a.createElement("div",{className:m},n.a.createElement("div",{className:"Message-content"},n.a.createElement("div",{className:"username"},l),n.a.createElement("div",{className:"message-body"},n.a.createElement("div",{className:"text"},a),n.a.createElement("div",{className:"created"},o)))))},s.state={showPopup:!1},s.atBottom=!0,s.messageFromSelf=!0,s.togglePopup=s.togglePopup.bind(Object(m.a)(s)),s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){!this.props.atBottom&&this.messageFromSelf?this.scrollToBottom():this.props.atBottom&&this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){!this.props.atBottom&&this.messageFromSelf?this.scrollToBottom():this.props.atBottom&&this.scrollToBottom()}},{key:"render",value:function(){var e=this;return console.log("Initial: ",this.atBottom),console.log("showPopup: ",this.state.showPopup),n.a.createElement("ul",{className:"MessageList-container",onScroll:this.handleScroll},this.props.messages.map((function(t){return e.renderMessage(t)})),this.state.showPopup||!this.atBottom?n.a.createElement(d,{closePopup:this.togglePopup.bind(this)}):null,n.a.createElement("li",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(n.a.Component),b=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={text:""},s.onChange=s.onChange.bind(Object(m.a)(s)),s.onSubmit=s.onSubmit.bind(Object(m.a)(s)),s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){this.setState({text:e.target.value})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSubmit(this.state.text),this.setState({text:""})}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("form",{ref:"form",className:"message-form",onSubmit:this.onSubmit},n.a.createElement("input",{className:"textfield",type:"text",value:this.state.text,placeholder:"Type your message here",onChange:this.onChange})))}}]),t}(n.a.Component),v=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("ul",{className:"OnlineUsers-container"},this.props.onlineUsers.map((function(t){return e.renderUsers(t)})))}},{key:"renderUsers",value:function(e){return n.a.createElement("li",{className:"OnlineUsers"},n.a.createElement("div",{className:"User"},e))}}]),t}(n.a.Component),f=function(e){function t(e){var s;Object(i.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={messages:[],token:s.props.token,currentUser:s.props.username,users:[],url:s.props.url},s.atBottom=!1;return s.streamSource=new EventSource(s.state.url+"/stream/"+s.state.token),s.getToken=s.getToken.bind(Object(m.a)(s)),s.setMessageList=s.setMessageList.bind(Object(m.a)(s)),s.sendMessage=s.sendMessage.bind(Object(m.a)(s)),s.setUsersList=s.setUsersList.bind(Object(m.a)(s)),s.joinUsersList=s.joinUsersList.bind(Object(m.a)(s)),s.partUsersList=s.partUsersList.bind(Object(m.a)(s)),s.changeScrollState=s.changeScrollState.bind(Object(m.a)(s)),s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getToken",value:function(e){this.setState({token:e})}},{key:"setMessageList",value:function(e){this.setState({messages:[].concat(Object(p.a)(this.state.messages),[e])})}},{key:"joinUsersList",value:function(e){var t=new Set(this.state.users),s=e.message,a=s+" has joined the chat";e.message=a,t.has(s)||this.setState({users:[].concat(Object(p.a)(this.state.users),[s]),messages:[].concat(Object(p.a)(this.state.messages),[e])})}},{key:"partUsersList",value:function(e){var t=new Set(this.state.users),s=e.message,a=s+" has left the chat";e.message=a,t.delete(s),this.setState({users:Object(p.a)(t),messages:[].concat(Object(p.a)(this.state.messages),[e])})}},{key:"setUsersList",value:function(e){this.setState({users:e})}},{key:"disconnectConnection",value:function(){this.streamSource.close(),this.props.onDisconnect()}},{key:"componentDidMount",value:function(){var e=this;this.streamSource.addEventListener("ServerStatus",(function(t){e.setMessageList({message:JSON.parse(t.data).status,user:"Server",created:JSON.parse(t.data).created})})),this.streamSource.addEventListener("Message",(function(t){e.setMessageList(JSON.parse(t.data))})),this.streamSource.addEventListener("Users",(function(t){e.setUsersList(JSON.parse(t.data).users)})),this.streamSource.addEventListener("Join",(function(t){e.joinUsersList({message:JSON.parse(t.data).user,user:"Server",created:JSON.parse(t.data).created})})),this.streamSource.addEventListener("Part",(function(t){e.partUsersList({message:JSON.parse(t.data).user,user:"Server",created:JSON.parse(t.data).created})})),this.streamSource.addEventListener("Disconnect",(function(t){e.disconnectConnection()}))}},{key:"sendMessage",value:function(e){var t=new FormData;t.append("message",e);var s=this.state.url,a=new XMLHttpRequest;a.open("POST",s+"/message");this.state.token;a.setRequestHeader("Authorization","Bearer "+this.state.token),a.send(t)}},{key:"changeScrollState",value:function(e){this.atBottom=e}},{key:"render",value:function(){return n.a.createElement("div",{className:"ChatScreen"},n.a.createElement("div",{className:"ChatHeader"},n.a.createElement("h1",{className:"ChatHeaderText"},"Enjoy your chat ",this.state.currentUser)),n.a.createElement("div",{ref:this.messageListRef,className:"ChatDetails"},n.a.createElement(v,{onlineUsers:this.state.users}),n.a.createElement(S,{messages:this.state.messages,changeScrollState:this.changeScrollState,atBottom:this.atBottom})),n.a.createElement("div",{className:"Message-input-block"},n.a.createElement(b,{onSubmit:this.sendMessage})))}}]),t}(a.Component),O=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={currentScreen:sessionStorage.getItem("currentScreen")||"LoginScreen",currentUsername:sessionStorage.getItem("currentUsername")||"",token:sessionStorage.getItem("token")||"",url:"http://chat.cs291.com/"},e.onUserloginSubmit=e.onUserloginSubmit.bind(Object(m.a)(e)),e.onDisconnect=e.onDisconnect.bind(Object(m.a)(e)),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onUserloginSubmit",value:function(e,t,s){var a=new XMLHttpRequest,n=new FormData;n.append("password",t),n.append("username",e),sessionStorage.url=s,a.open("POST",sessionStorage.url+"/login"),a.onreadystatechange=function(){4===a.readyState&&(201===a.status?(sessionStorage.setItem("token",JSON.parse(a.responseText).token),sessionStorage.setItem("currentScreen","ChatScreen"),sessionStorage.setItem("currentUsername",e),this.setState({currentUsername:e,currentScreen:sessionStorage.getItem("currentScreen"),token:sessionStorage.getItem("token")})):403===this.status?alert("Invalid username or password"):alert(this.status+" failure to /login"))}.bind(this),a.send(n)}},{key:"onDisconnect",value:function(){this.setState({currentScreen:"LoginScreen"})}},{key:"render",value:function(){return"LoginScreen"===this.state.currentScreen?n.a.createElement(g,{onSubmit:this.onUserloginSubmit,url:this.state.url}):"ChatScreen"===this.state.currentScreen?n.a.createElement(f,{token:this.state.token,username:this.state.currentUsername,url:sessionStorage.url,onDisconnect:this.onDisconnect}):void 0}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},7:function(e,t,s){}},[[11,1,2]]]);
//# sourceMappingURL=main.802540f6.chunk.js.map